<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SADE NET | Infinite Impact</title>
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/toastify-js/src/toastify.min.css">
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/toastify-js"></script>
    <style>
        :root { --orange: #ff6600; --dark: #0f0f0f; --glass: rgba(255, 255, 255, 0.05); }
        body { font-family: 'Inter', sans-serif; background: var(--dark); color: white; margin: 0; display: flex; justify-content: center; align-items: center; min-height: 100vh; }
        
        .main-card { background: var(--glass); backdrop-filter: blur(15px); border: 1px solid rgba(255, 255, 255, 0.1); padding: 2.5rem; border-radius: 30px; width: 90%; max-width: 400px; text-align: center; box-shadow: 0 25px 50px rgba(0,0,0,0.5); }
        .logo { font-size: 1.8rem; font-weight: 900; color: var(--orange); margin-bottom: 0.5rem; }
        .tagline { font-size: 0.8rem; opacity: 0.6; margin-bottom: 2rem; }

        .input-group { text-align: left; margin-bottom: 15px; }
        label { font-size: 0.7rem; font-weight: bold; text-transform: uppercase; color: var(--orange); margin-left: 5px; }
        
        select, input { width: 100%; padding: 15px; background: rgba(255,255,255,0.08); border: 1px solid rgba(255,255,255,0.1); border-radius: 15px; color: white; font-size: 1rem; margin-top: 5px; box-sizing: border-box; }
        select option { background: #1a1a1a; }

        /* Modal / Popup Styles */
        .modal-overlay { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.9); z-index: 1000; align-items: center; justify-content: center; padding: 20px; }
        .modal-content { background: #1a1a1a; padding: 2rem; border-radius: 25px; text-align: center; border: 1px solid var(--orange); width: 100%; max-width: 320px; }

        .bar-container { display: flex; align-items: flex-end; justify-content: center; gap: 5px; height: 40px; margin-bottom: 20px; }
        .bar { width: 6px; border-radius: 3px; animation: wave 1s infinite ease-in-out; }
        @keyframes wave { 0%, 100% { height: 10px; background: var(--orange); } 50% { height: 40px; background: #ffcc00; } }
        .bar:nth-child(2) { animation-delay: 0.1s; } .bar:nth-child(3) { animation-delay: 0.2s; } .bar:nth-child(4) { animation-delay: 0.3s; }

        .timer { font-size: 1.5rem; font-weight: bold; color: var(--orange); margin: 10px 0; }
        .funny-msg { font-size: 0.85rem; color: #ccc; font-style: italic; min-height: 40px; }

        button { background: var(--orange); color: white; border: none; padding: 18px; width: 100%; border-radius: 15px; font-weight: bold; cursor: pointer; transition: 0.3s; margin-top: 10px; }
        button:hover { transform: scale(1.02); background: #e65c00; }
    </style>
</head>
<body>

    <div class="main-card">
        <div class="logo">SADE NET</div>
        <div class="tagline">By Vinnie Digital Hub</div>

        <div class="input-group">
            <label>Select Your Plan</label>
            <select id="plan-select">
                <option value="5">5/= (30 Mins) - Lite</option>
                <option value="10" selected>10/= (1 Hour) - ⭐ RECOMMENDED</option>
                <option value="20">20/= (4 Hours) - Heavy</option>
                <option value="50">50/= (24 Hours) - Unlimited</option>
                <option value="100">100/= (3 Days) - Weekend Vibe</option>
            </select>
        </div>

        <div class="input-group">
            <label>M-PESA Number</label>
            <input type="text" id="phone" placeholder="07XXXXXXXX">
        </div>

        <button onclick="initiateSadeNet()">Get Connected</button>
    </div>

    <div class="modal-overlay" id="sade-modal">
        <div class="modal-content">
            <div class="bar-container">
                <div class="bar"></div><div class="bar"></div><div class="bar"></div><div class="bar"></div>
            </div>
            <div id="modal-status-title" style="font-weight: bold; margin-bottom: 10px; color: var(--orange);">Waking up servers...</div>
            <div id="funny-msg" class="funny-msg">Hold on, Vinnie is pedaling the server bike...</div>
            <div id="timer" class="timer">02:00</div>
            <button id="close-modal" style="display:none; background: #333;" onclick="closeModal()">Close</button>
        </div>
    </div>

    <script>
        const msgs = [
            "This won't take a century, maybe...",
            "Checking if Safaricom is awake...",
            "Brewing your connection...",
            "Almost there, don't throw your phone...",
            "Sade Net is faster than your ex's replies...",
            "Connecting to the satellites in Embu..."
        ];

        let timerInterval;

        function initiateSadeNet() {
            const phone = document.getElementById('phone').value;
            if(!phone) return showToast("Enter your number!", "error");

            openModal("Waking up servers...", "Hold a bit, initializing Sade Net...");
            startTimer(120);
            cycleMessages();

            // Actual API Call
            fetch('https://www.gathuo.app/v1/initiate-pay', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({
                    phone: phone,
                    amount: document.getElementById('plan-select').value,
                    reference: "SADE NET",
                    desc: "Sade Net WiFi"
                })
            })
            .then(res => res.json())
            .then(data => {
                if(data.CheckoutRequestID) {
                    updateModal("Confirming with Safaricom...", "Check your phone for the M-PESA prompt!");
                    startTimer(60); // Reset timer for callback wait
                    pollStatus(data.CheckoutRequestID);
                }
            })
            .catch(() => {
                updateModal("Oops!", "Server took too long to wake up. Try again.");
                document.getElementById('close-modal').style.display = 'block';
            });
        }

        async function pollStatus(id) {
            const itv = setInterval(async () => {
                try {
                    const res = await fetch(`https://www.gathuo.app/v1/query/${id}`);
                    const data = await res.json();

                    if(data.status === "SUCCESS") {
                        clearInterval(itv);
                        updateModal("CONNECTED! ✅", "Enjoy Sade Net. Infinite Impact confirmed!");
                        document.getElementById('close-modal').style.display = 'block';
                    } else if(data.status === "FAILED") {
                        clearInterval(itv);
                        let failMsg = "Safaricom told us you are broke, top up!";
                        if(data.message.includes("cancel")) failMsg = "Why did you cancel? Sade Net missed you.";
                        updateModal("Payment Failed ❌", failMsg);
                        document.getElementById('close-modal').style.display = 'block';
                    }
                } catch(e) {}
            }, 3000);
        }

        // UI Helpers
        function openModal(title, msg) {
            document.getElementById('sade-modal').style.display = 'flex';
            document.getElementById('modal-status-title').innerText = title;
            document.getElementById('funny-msg').innerText = msg;
            document.getElementById('close-modal').style.display = 'none';
        }

        function updateModal(title, msg) {
            document.getElementById('modal-status-title').innerText = title;
            document.getElementById('funny-msg').innerText = msg;
        }

        function closeModal() {
            document.getElementById('sade-modal').style.display = 'none';
            clearInterval(timerInterval);
        }

        function startTimer(duration) {
            clearInterval(timerInterval);
            let time = duration;
            timerInterval = setInterval(() => {
                let mins = Math.floor(time / 60);
                let secs = time % 60;
                document.getElementById('timer').innerText = `0${mins}:${secs < 10 ? '0' : ''}${secs}`;
                if (--time < 0) clearInterval(timerInterval);
            }, 1000);
        }

        function cycleMessages() {
            setInterval(() => {
                if(document.getElementById('sade-modal').style.display === 'flex') {
                    document.getElementById('funny-msg').innerText = msgs[Math.floor(Math.random() * msgs.length)];
                }
            }, 5000);
        }

        function showToast(msg, type) {
            Toastify({ text: msg, duration: 3000, style: { background: type === "success" ? "#28a745" : "#ff6600" } }).showToast();
        }
    </script>
</body>
</html>
